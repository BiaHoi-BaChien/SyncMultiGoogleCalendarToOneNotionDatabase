# Notion API 2025-09-03 への移行仕様（決定事項）

## 目的
- すべての Notion 呼び出しを 2025-09-03 に対応。
- database_id 依存の書き込みを data_source_id ベースへ移行。
- /v1/databases のうち data source 固有機能は /v1/data_sources.* に移動。

## 必須変更
1. 共通ヘッダ: Notion-Version=2025-09-03
2. 親指定: parent.type=data_source_id / parent.data_source_id=...
3. クエリ: POST /v1/data_sources/{id}/query を使用
4. スキーマ取得/更新: /v1/data_sources/{id} (GET/PATCH)
5. 検索フィルタ: object=data_source（旧 database は不可）
6. SDK（使っていれば）: @notionhq/client v5、notion.dataSources.* を優先
7. Webhook: data.parent.data_source_id を利用（バージョン指定あり）

## 実装ポリシー
- data_source_id は起動時/初回アクセス時に GET /v1/databases/{db}/ から取得し、ローカルにキャッシュ。
- database_id は読み取り用に保持してもよいが、**書き込みリクエストでは送らない**。
- 既存の DB が単一ソースでも、data_sources[0].id を利用。
